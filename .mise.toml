[tools]
flutter = "3.38.1-stable"
bun = "latest"

[tasks.setup]
description = "ä¾å­˜é–¢ä¿‚ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã¨ã‚³ãƒ¼ãƒ‰ç”Ÿæˆ"
run = """
echo "ğŸ“¦ ä¾å­˜é–¢ä¿‚ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ä¸­..."
cd server && bun install
cd ../client && flutter pub get
echo "ğŸ”§ ã‚³ãƒ¼ãƒ‰ç”Ÿæˆä¸­..."
cd client && dart run build_runner build --delete-conflicting-outputs
echo "âœ… ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—å®Œäº†"
"""

[tasks.install]
description = "ä¾å­˜é–¢ä¿‚ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã®ã¿"
run = """
echo "ğŸ“¦ ã‚µãƒ¼ãƒãƒ¼ã®ä¾å­˜é–¢ä¿‚ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ä¸­..."
cd server && bun install
echo "ğŸ“¦ ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã®ä¾å­˜é–¢ä¿‚ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ä¸­..."
cd ../client && flutter pub get
echo "âœ… ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«å®Œäº†"
"""

[tasks.server]
description = "ã‚µãƒ¼ãƒãƒ¼ã‚’èµ·å‹•"
run = "cd server && bun run src/index.ts"

[tasks.client]
description = "Flutterã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚’èµ·å‹• (macOS)"
run = "cd client && flutter run -d macos"

[tasks.client2]
description = "Flutterã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ2ã‚’èµ·å‹• (macOS)"
run = "cd client && flutter run -d macos"

[tasks.client3]
description = "Flutterã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ3ã‚’èµ·å‹• (macOS)"
run = "cd client && flutter run -d macos"

[tasks.dev]
description = "ã‚µãƒ¼ãƒãƒ¼ + ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ1ã¤ã‚’èµ·å‹•"
depends = ["server", "client"]

[tasks.build]
description = "freezedã‚³ãƒ¼ãƒ‰ç”Ÿæˆ"
run = "cd client && dart run build_runner build --delete-conflicting-outputs"

[tasks.watch]
description = "freezedã‚³ãƒ¼ãƒ‰ç”Ÿæˆï¼ˆç›£è¦–ãƒ¢ãƒ¼ãƒ‰ï¼‰"
run = "cd client && dart run build_runner watch --delete-conflicting-outputs"

[tasks.web-build]
description = "Flutter Webã‚’ãƒ“ãƒ«ãƒ‰"
run = "cd client && flutter build web"

[tasks.kill]
description = "å…¨ã¦ã®é–‹ç™ºãƒ—ãƒ­ã‚»ã‚¹ã‚’åœæ­¢"
run = """
echo "ğŸ›‘ é–‹ç™ºãƒ—ãƒ­ã‚»ã‚¹ã‚’åœæ­¢ä¸­..."
pkill -f "bun run src/index.ts" 2>/dev/null && echo "  âœ“ ã‚µãƒ¼ãƒãƒ¼ã‚’åœæ­¢" || echo "  - ã‚µãƒ¼ãƒãƒ¼ã¯èµ·å‹•ã—ã¦ã„ã¾ã›ã‚“"
pkill -f "flutter run" 2>/dev/null && echo "  âœ“ Flutterã‚’åœæ­¢" || echo "  - Flutterã¯èµ·å‹•ã—ã¦ã„ã¾ã›ã‚“"
pkill -f "miro_example" 2>/dev/null && echo "  âœ“ macOSã‚¢ãƒ—ãƒªã‚’åœæ­¢" || echo "  - macOSã‚¢ãƒ—ãƒªã¯èµ·å‹•ã—ã¦ã„ã¾ã›ã‚“"
echo "âœ… å®Œäº†"
"""

[tasks.clients]
description = "è¤‡æ•°ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã®èµ·å‹•æ–¹æ³•"
run = """
echo "=== è¤‡æ•°ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã®èµ·å‹•æ–¹æ³• ==="
echo "1. ã‚¿ãƒ¼ãƒŸãƒŠãƒ«1: mise run server"
echo "2. ã‚¿ãƒ¼ãƒŸãƒŠãƒ«2: mise run client"
echo "3. ã‚¿ãƒ¼ãƒŸãƒŠãƒ«3: mise run client2"
echo "4. ã‚¿ãƒ¼ãƒŸãƒŠãƒ«4: mise run client3"
echo ""
echo "å…¨ã¦åœæ­¢: mise run kill"
"""
